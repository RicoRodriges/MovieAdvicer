<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" th:href="@{/css/mainPage.css}"/>
    <script
            src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            var movies = [];
            $("div.text-count").text(movies.length + " movies selected");
            $("button.go-btn").hide();
            $("button").click(function () {
                $("#results").remove();
                $("body").append("<div id=\"results\"></div>");
                var film_name = $("#input-search").val()
                $.getJSON("movies", {q: film_name}, results =>
                    results.forEach(movie => {
                        $("#results").append("<p class=results >" + movie.title + "</p>")
                        $("#results").append("<p class=results><img width=\"60%\" class=results src=\"https://image.tmdb.org/t/p/w300" + movie.poster_path + "\" /></p>");
                        $("#results").append("<p class=film-button id=\"" + movie.id + "\"> <button>+</button></p>")
                        $("#results").append("</div>");
                        $("#results").append("<hr>");
                    })
                );


            });
            $(document).on('click', ".film-button", function () {
                if (!movies.includes(this.id)) movies.push(this.id);
                $("div.text-count").text(movies.length + " movies selected");
                $("button.go-btn").show();
            });
            $(document).on('click', ".remove-btn", function () {
                movies = [];
                $("div.text-count").text(movies.length + " movies selected");
                $("button.go-btn").hide();
            });
            $(document).on('click', ".go-btn", function () {
                var url = "/moviesAdvicer/propose?count=20&ids=";
                for (var i in movies) {
                    if (i < movies.length - 1) {
                        url += movies[i] + ",";
                    } else {
                        url += movies[i];
                    }
                }
                $("div.design").hide();
                $("#results").hide();
                $("body").append("<div class=\"cssload-loader\">Loading</div>");
                $(location).attr('href', url);

            });
        });
    </script>
</head>
<body>
<div class=design>
    <h2 class=site-title>Add base movie</h2>
    <div class="wrap">
        <div class="search">
            <input type="text" class="searchTerm" id="input-search"
                   placeholder="What movie are you looking for?">
            <button type="submit" class="searchButton" id="searchButton">
                <img
                        src="/images/searching.png"
                        width="20px"/>
            </button>
        </div>
    </div>
    <div class=count-panel>
        <img class=movie-img src="/images/film.png" width="100px">
        <div class=text-count></div>
    </div>
    <button class=remove-btn>Remove all</button>
    <button class=go-btn><img src="/images/go.png" width="100%"></button>
</div>
</body>
</html>